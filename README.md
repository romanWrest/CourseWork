API Интернет-магазина

Обзор

API Интернет-магазина — это RESTful веб-приложение для управления платформой электронной коммерции. Оно поддерживает аутентификацию пользователей, управление товарами, обработку заказов и функциональность корзины в рамках микросервисной архитектуры. Проект использует асинхронные сообщения через RabbitMQ и Kafka для обработки событий и сбора метрик, отправляет уведомления клиентам по email через SMTP (Yandex) и включает консольный клиент для тестирования API.

Функциональность: 

Управление пользователями:
  - Регистрация и аутентификация с использованием JWT и хешированием паролей через BCrypt.
  - Ролевой доступ (роли Admin и User).
Управление товарами:
 - CRUD-операции для товаров (создание, просмотр, обновление, удаление), доступные только администраторам.
 - Каталог товаров с информацией о названии, цене и описании.
Управление заказами:
 - Создание, просмотр, обновление и удаление заказов с привязкой к товарам.
 - Обновление статуса заказов (например, Pending, Paid, Shipped) с асинхронными уведомлениями через RabbitMQ.
 - Автоматический расчет общей стоимости заказа на основе выбранных товаров.
Корзина:
 - Добавление товаров в корзину пользователя с отправкой событий в Kafka для аналитики.
Асинхронная обработка:
 - RabbitMQ для обработки уведомлений о создании заказов и обновлении статусов.
 - Kafka для сбора и обработки системных метрик (например, время выполнения запросов) и пользовательских событий.
Уведомления по email:
 - Автоматическая отправка уведомлений клиентам о создании заказа и обновлении его статуса через SMTP (Yandex).
База данных:
 - SQLite с использованием Entity Framework Core для хранения данных.
 - Миграции для управления схемой базы данных и начальной загрузкой данных (пример пользователей и товаров).
Загрузка файлов:
 - Поддержка загрузки файлов (например, изображений товаров) в локальную директорию.
Мониторинг и аналитика:
 - Фоновые сервисы для обработки сообщений Kafka (события пользователей и системные метрики).

Консольный клиент:
 - Приложение на C# для взаимодействия с API, поддерживающее вход, управление товарами, заказами и корзиной.

Технологии
  Backend: C#, ASP.NET Core, Entity Framework Core
  База данных: SQLite
  Системы сообщений: RabbitMQ, Kafka
  Аутентификация: JWT, BCrypt
  Логирование: Serilog
  Уведомления: MailKit (SMTP для Yandex)
  Другие библиотеки: Newtonsoft.Json

Тестирование: Консольный клиент для взаимодействия с API
Среда разработки: Локальная настройка с поддержкой Docker для Kafka и RabbitMQ

Структура проекта
 - Controllers: Обработка HTTP-запросов для пользователей, товаров, заказов и корзины.
 - Models: Определение сущностей (User, Product, Order) и их связей.
 - Services: Фоновые сервисы для Kafka (AnalyticsService, MonitoringService), RabbitMQ (NotificationService), генерации JWT и обработки файлов.
 - Migrations: Управление схемой базы данных и начальная загрузка данных.
 - Client: Консольное приложение для тестирования API.


Установка и запуск

Требования
 - .NET 8.0 SDK
 - Docker (для Kafka и RabbitMQ)
 - Учетные данные SMTP-сервера (например, Yandex SMTP)

Шаги
1.  Склонируйте репозиторий:
``` 
git clone https://github.com/romanWrest/CourseWork.git
```

2.  Перейдите в директорию проекта:
```
cd CourseWork
```
3.  Обновите appsettings.json, указав учетные данные SMTP и ключ JWT.
4.  Запустите Kafka и RabbitMQ с помощью Docker:
```
docker-compose up -d
```


5.  Примените миграции базы данных:
```
cd OnlineStore
dotnet ef database update
```
6.  Запустите API:
```
dotnet run --project OnlineStore
```
7.  Запустите консольный клиент:
```
cd ../OnlineStoreClient
dotnet run
```
Конфигурация
 - Настройте ConnectionStrings:DefaultConnection в appsettings.json для SQLite.
 - Укажите настройки подключения Kafka и RabbitMQ, если они отличаются от localhost.
 - Настройте параметры SMTP в appsettings.json для отправки email-уведомлений.

Использование

API-эндпоинты

- POST ```/api/users/register``` — Регистрация нового пользователя.
- POST ```/api/users/login``` — Аутентификация и получение JWT-токена.
- GET ```/api/products ``` — Список всех товаров (требуется аутентификация).
- POST ```/api/products``` — Добавление нового товара (только для Admin).
- POST ```/api/orders``` — Создание заказа с товарами.
- PUT ```/api/orders/{id}/status``` — Обновление статуса заказа.
- POST ```/api/cart/add``` — Добавление товара в корзину.

Консольный клиент
 - Запустите клиент и выберите опции (1–11) для взаимодействия с API.
 - Пример: Войдите как admin (пароль: admin) для доступа к функциям администратора.

Планы по улучшению
 - Добавить модульные тесты с использованием xUnit или NUnit.
 - Расширить функциональность корзины с сохранением данных.
 - Добавить поддержку количества товаров в заказах и корзине.
 - Интегрировать фронтенд (например, React) для улучшения интерфейса.
